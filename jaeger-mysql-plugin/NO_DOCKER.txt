â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘   ä¸ä½¿ç”¨ Docker æ„å»º Jaeger MySQL å­˜å‚¨æ’ä»¶                  â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ é€‚ç”¨åœºæ™¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Lima K3s VM ç¯å¢ƒï¼ˆæ—  Dockerï¼‰
âœ“ ç›´æ¥åœ¨ K3s èŠ‚ç‚¹ä¸Šæ„å»º
âœ“ ä½¿ç”¨ containerd/crictl è¿è¡Œæ—¶


ğŸš€ å¿«é€Ÿå¼€å§‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd /Users/tal/dock/goutils/k3s/lianlu/jaeger-mysql-plugin

./build-without-docker.sh


ğŸ“‹ æ„å»ºæ–¹å¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨æœ€ä½³æ–¹å¼ï¼š

æ–¹å¼ 1: nerdctlï¼ˆK3s è‡ªå¸¦ï¼‰
  âœ“ æœ€ç®€å•
  âœ“ ç›´æ¥æ„å»ºé•œåƒ
  âœ“ è‡ªåŠ¨åœ¨ containerd ä¸­

æ–¹å¼ 2: buildah
  âœ“ æ— éœ€ Docker
  âœ“ æ„å»º OCI é•œåƒ
  âœ“ å¯¼å…¥åˆ° containerd

æ–¹å¼ 3: çº¯é™æ€æ„å»ºï¼ˆfallbackï¼‰
  âœ“ åªéœ€è¦ Go
  âœ“ ä½¿ç”¨ ConfigMap + initContainer
  âœ“ æ— éœ€é•œåƒæ„å»ºå·¥å…·


âš™ï¸ å‰ææ¡ä»¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¿…éœ€:
  âœ“ Go 1.21+
  âœ“ kubectl

å¯é€‰ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ï¼‰:
  â—‹ nerdctlï¼ˆæ¨èï¼ŒK3s é€šå¸¸è‡ªå¸¦ï¼‰
  â—‹ buildah
  â—‹ éƒ½æ²¡æœ‰ä¹Ÿå¯ä»¥ï¼ˆä½¿ç”¨é™æ€æ„å»ºï¼‰


ğŸ”§ å®‰è£… Goï¼ˆå¦‚æœéœ€è¦ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc


ğŸ“Š æ„å»ºæµç¨‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. æ£€æŸ¥ç¯å¢ƒï¼ˆGo, kubectl, nerdctl/buildahï¼‰
2. ä½¿ç”¨ Go ç¼–è¯‘é™æ€äºŒè¿›åˆ¶
3. åˆ›å»ºå®¹å™¨é•œåƒï¼ˆæˆ– ConfigMapï¼‰
4. å¯¼å…¥åˆ° containerd
5. éƒ¨ç½² ManticoreSearchï¼ˆå¦‚æœéœ€è¦ï¼‰
6. éƒ¨ç½² MySQL å­˜å‚¨æ’ä»¶
7. éƒ¨ç½² Jaeger Collector å’Œ Query
8. éªŒè¯éƒ¨ç½²


âœ… æˆåŠŸæ ‡å¿—
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ‰€æœ‰ Pods å¤„äº Running çŠ¶æ€:
  manticore-xxx
  jaeger-mysql-plugin-xxx
  jaeger-collector-grpc-xxx
  jaeger-query-grpc-xxx


ğŸ” éªŒè¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# æŸ¥çœ‹ Pods
kubectl get pods -n tracing

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -n tracing -l app=jaeger-mysql-plugin -f

# æ£€æŸ¥é•œåƒï¼ˆå¦‚æœä½¿ç”¨ nerdctl/buildahï¼‰
sudo crictl images | grep jaeger-mysql-plugin

# è®¿é—® UI
http://localhost:30686


ğŸ› æ•…éšœæ’æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é—®é¢˜: Go æœªå®‰è£…
è§£å†³: å‚è§ä¸Šé¢çš„ "å®‰è£… Go" éƒ¨åˆ†

é—®é¢˜: ç¼–è¯‘å¤±è´¥
è§£å†³: 
  go mod tidy
  go mod download

é—®é¢˜: nerdctl æœªæ‰¾åˆ°
è¯´æ˜: æ²¡å…³ç³»ï¼Œè„šæœ¬ä¼šä½¿ç”¨å…¶ä»–æ–¹å¼

é—®é¢˜: Pod ImagePullBackOff
è¯´æ˜: å¦‚æœä½¿ç”¨é™æ€æ„å»ºæ–¹å¼ï¼Œè¿™æ˜¯æ­£å¸¸çš„
      ConfigMap éƒ¨ç½²ä¸éœ€è¦é•œåƒ


ğŸ’¡ ä¼˜åŠ¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

vs Docker æ–¹å¼:
  âœ“ æ— éœ€ Docker daemon
  âœ“ æ›´è½»é‡
  âœ“ ç›´æ¥é›†æˆ containerd
  âœ“ é€‚åˆ K3s ç¯å¢ƒ

vs æ‰‹åŠ¨æ„å»º:
  âœ“ è‡ªåŠ¨åŒ–å®Œæ•´æµç¨‹
  âœ“ è‡ªåŠ¨æ£€æµ‹æœ€ä½³æ–¹å¼
  âœ“ åŒ…å«é”™è¯¯å¤„ç†


ğŸ“– ç›¸å…³æ–‡ä»¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

build-without-docker.sh  - ä¸»æ„å»ºè„šæœ¬ï¼ˆæœ¬æ–‡ä»¶å¯¹åº”ï¼‰
build-and-deploy.sh      - Docker ç‰ˆæœ¬ï¼ˆéœ€è¦ Dockerï¼‰
CONTAINERD.md            - containerd ç¯å¢ƒè¯´æ˜
README.md                - å®Œæ•´æ–‡æ¡£


ğŸ”„ ä¸ Docker ç‰ˆæœ¬å¯¹æ¯”
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

build-and-deploy.sh (Docker ç‰ˆæœ¬):
  â€¢ éœ€è¦ Docker
  â€¢ åœ¨å®¿ä¸»æœºæ„å»º
  â€¢ å¯¼å…¥åˆ° VM

build-without-docker.sh (æœ¬è„šæœ¬):
  â€¢ ä¸éœ€è¦ Docker
  â€¢ ç›´æ¥åœ¨ VM ä¸­æ„å»º
  â€¢ ä½¿ç”¨ nerdctl/buildah/é™æ€æ„å»º


ğŸ¯ æ¨èä½¿ç”¨åœºæ™¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ åœ¨ Lima K3s VM ä¸­ç›´æ¥æ„å»º
âœ“ K3s èŠ‚ç‚¹ä¸Šæ²¡æœ‰ Docker
âœ“ æƒ³è¦æ›´è½»é‡çš„æ„å»ºæµç¨‹
âœ“ CI/CD ç¯å¢ƒï¼ˆæ—  Dockerï¼‰


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç«‹å³å¼€å§‹: ./build-without-docker.sh




