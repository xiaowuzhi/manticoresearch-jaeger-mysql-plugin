â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘   Jaeger MySQL å­˜å‚¨æ’ä»¶ - å¿«é€Ÿå¼€å§‹                         â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ ç›®æ ‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½¿ç”¨ ManticoreSearch çš„ MySQL åè®®ä½œä¸º Jaeger å­˜å‚¨ï¼Œ
é¿å… Elasticsearch API çš„å…¼å®¹æ€§é—®é¢˜ã€‚

âš™ï¸ ç¯å¢ƒè¯´æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ‚¨çš„ K3s ä½¿ç”¨ containerd/crictl è¿è¡Œæ—¶
è„šæœ¬å·²ç»å®Œå…¨é€‚é… containerd ç¯å¢ƒ
è¯¦è§: CONTAINERD.md


ğŸš€ ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cd /Users/tal/dock/goutils/k3s/lianlu/jaeger-mysql-plugin

æ–¹å¼ 1: åœ¨ Lima K3s VM ä¸­ï¼ˆæ—  Dockerï¼‰â­
  ./build-without-docker.sh

æ–¹å¼ 2: åœ¨å®¿ä¸»æœºï¼ˆéœ€è¦ Dockerï¼‰
  ./build-and-deploy.sh


â±ï¸ é¢„è®¡æ—¶é—´: 5-10 åˆ†é’Ÿ


ğŸ“‹ è¯¥è„šæœ¬ä¼šåšä»€ä¹ˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âœ“ æ£€æŸ¥ç¯å¢ƒï¼ˆDocker, kubectlï¼‰
2. âœ“ æ„å»º MySQL å­˜å‚¨æ’ä»¶ï¼ˆGo â†’ Dockerï¼‰
3. âœ“ å¯¼å…¥é•œåƒåˆ° K3s
4. âœ“ éƒ¨ç½² ManticoreSearchï¼ˆå¦‚æœæœªéƒ¨ç½²ï¼‰
5. âœ“ éƒ¨ç½² MySQL å­˜å‚¨æ’ä»¶
6. âœ“ éƒ¨ç½² Jaeger Collectorï¼ˆgRPC æ¨¡å¼ï¼‰
7. âœ“ éƒ¨ç½² Jaeger Queryï¼ˆgRPC æ¨¡å¼ï¼‰
8. âœ“ éªŒè¯æ‰€æœ‰ç»„ä»¶


âœ… æˆåŠŸæ ‡å¿—
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ‰€æœ‰ Pods å¤„äº Running çŠ¶æ€:
  âœ“ manticore-xxx
  âœ“ jaeger-mysql-plugin-xxx
  âœ“ jaeger-collector-grpc-xxx
  âœ“ jaeger-query-grpc-xxx

æ²¡æœ‰ CrashLoopBackOff æˆ–é”™è¯¯æ—¥å¿—


ğŸŒ è®¿é—® Jaeger UI
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

http://localhost:30686


ğŸ—ï¸ æ¶æ„è¯´æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Go App â†’ Jaeger Collector (gRPC Plugin Mode)
                â†“
         MySQL Plugin (ç«¯å£ 17271)
                â†“
         ManticoreSearch (MySQL ç«¯å£ 9306)
                â†‘
         Jaeger Query (gRPC Plugin Mode)


ğŸ” éªŒè¯å‘½ä»¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶
kubectl get pods -n tracing

# æŸ¥çœ‹ MySQL æ’ä»¶æ—¥å¿—
kubectl logs -n tracing -l app=jaeger-mysql-plugin -f

# æŸ¥çœ‹ Collector æ—¥å¿—
kubectl logs -n tracing -l component=collector-grpc -f

# æµ‹è¯• ManticoreSearch MySQL ç«¯å£
kubectl exec -n tracing deployment/manticore -- nc -zv localhost 9306

# æµ‹è¯•æ’ä»¶ gRPC ç«¯å£
kubectl exec -n tracing deployment/jaeger-mysql-plugin -- nc -zv localhost 17271


ğŸ“– è¯¦ç»†æ–‡æ¡£
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æŸ¥çœ‹å®Œæ•´è¯´æ˜:
  cat README.md


ğŸ’¡ å…³é”®ä¼˜åŠ¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

vs ManticoreSearch ES API:
  âœ“ é¿å… JSON æ ¼å¼å…¼å®¹æ€§é—®é¢˜
  âœ“ ä¸ä¼šå‡ºç° "cannot unmarshal string" é”™è¯¯
  âœ“ MySQL åè®®æ›´ç¨³å®š

vs å†…å­˜å­˜å‚¨:
  âœ“ æ•°æ®æŒä¹…åŒ–
  âœ“ Pod é‡å¯åæ•°æ®ä¸ä¸¢å¤±
  âœ“ å¯ä»¥æŸ¥è¯¢å†å²è¿½è¸ª


ğŸ› æ•…éšœæ’æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¦‚æœéƒ¨ç½²å¤±è´¥:

1. æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
   docker ps

2. æ£€æŸ¥ K3s æ˜¯å¦æ­£å¸¸
   kubectl get nodes

3. æ£€æŸ¥å‘½åç©ºé—´
   kubectl get namespace tracing

4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
   kubectl describe pod -n tracing <pod-name>


ğŸ”„ é‡æ–°éƒ¨ç½²
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¦‚éœ€é‡æ–°éƒ¨ç½²:

# æ¸…ç†
kubectl delete deployment jaeger-mysql-plugin jaeger-collector-grpc jaeger-query-grpc -n tracing

# é‡æ–°æ„å»ºå’Œéƒ¨ç½²
./build-and-deploy.sh


ğŸ“Š æ•°æ®éªŒè¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# æŸ¥çœ‹æ•°æ®åº“è¡¨
kubectl exec -n tracing deployment/manticore -- \
  mysql -h127.0.0.1 -P9306 -e "SHOW TABLES FROM jaeger"

# æŸ¥çœ‹ span æ•°é‡
kubectl exec -n tracing deployment/manticore -- \
  mysql -h127.0.0.1 -P9306 jaeger -e "SELECT COUNT(*) FROM jaeger_spans"

# æŸ¥çœ‹æœ€è¿‘çš„ spans
kubectl exec -n tracing deployment/manticore -- \
  mysql -h127.0.0.1 -P9306 jaeger -e "SELECT service_name, operation_name FROM jaeger_spans LIMIT 10"


ğŸ¯ æµ‹è¯•è¿½è¸ª
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

éƒ¨ç½²å®Œæˆå:

1. è¿è¡Œæµ‹è¯•åº”ç”¨
   cd ../simple
   go run main.go

2. è®¿é—® Jaeger UI
   http://localhost:30686

3. æœç´¢æœåŠ¡åç§°
   åœ¨ UI ä¸­é€‰æ‹©æœåŠ¡æŸ¥çœ‹è¿½è¸ªæ•°æ®


âš™ï¸ é…ç½®è¯´æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ–‡ä»¶è¯´æ˜:
  main.go              - æ’ä»¶ä¸»ç¨‹åº
  store.go             - MySQL å­˜å‚¨å®ç°
  Dockerfile           - é•œåƒæ„å»ºæ–‡ä»¶
  build-and-deploy.sh  - éƒ¨ç½²è„šæœ¬
  ../k3s/04-jaeger-mysql-storage.yaml - K8s é…ç½®


ğŸ”— ç›¸å…³æ–‡ä»¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ../k3s/02-manticore.yaml  - ManticoreSearch éƒ¨ç½²
  ../simple/                - Go æµ‹è¯•åº”ç”¨


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç«‹å³å¼€å§‹: ./build-and-deploy.sh


